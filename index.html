<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ÏÉÅÌíà Ï°∞Ìöå</title>

  <!-- Í≥µÌÜµ Ïú†ÎãàÌååÏù¥Îìú(Ï†ÑÏó≠) -->
  <link rel="stylesheet" href="https://wskimkj.github.io/admin/css/glass-unified.css">

  <!-- ÌååÎπÑÏΩò -->
  <link rel="icon" type="image/png" href="android-chrome-512x512 (1).ico">

  <!-- Ìè∞Ìä∏ -->
  <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css">

  <!-- CSV ÌååÏÑú -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* =========================================
       BASE (ÏõêÎ≥∏ Ïä§ÌÉÄÏùº - Í∏∞Îä•/Î†àÏù¥ÏïÑÏõÉ Ïú†ÏßÄ)
       ========================================= */
    :root {
      --bg-gradient: radial-gradient(circle at top left, #f9a8d4 0, #e5e7eb 40%, #e0f2fe 100%);
      --card-bg: rgba(255, 255, 255, 0.96);
      --accent: #f472b6;
      --accent-soft: #fb7185;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --radius-xl: 18px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.18);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #f9fafb;
      color: var(--text-main);
    }

    .app-shell {
      width: 100%;
      min-height: 100vh;
      background: var(--bg-gradient);
      padding: 24px 24px 32px;
      position: relative;
      overflow: hidden;
    }

    .app-shell::before {
      content: "";
      position: absolute;
      width: 260px;
      height: 260px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(244, 114, 182, 0.15), transparent 70%);
      top: -120px;
      right: -80px;
      pointer-events: none;
    }

    .inner-shell {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      padding: 18px 20px 20px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.18);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 14px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .title-wrap h1 {
      margin: 0;
      font-size: 19px;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .title-tag {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid rgba(248, 113, 113, 0.4);
    }

    .title-wrap p {
      margin: 3px 0 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .header-right {
      text-align: right;
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
    }
    .header-right span {
      font-weight: 600;
      color: #0f766e;
    }

    .pill-label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }
    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #22c55e;
    }

    .content-row {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: stretch;
    }

    .card {
      background: rgba(255, 255, 255, 0.96);
      border-radius: var(--radius-xl);
      padding: 14px 16px 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.06);
    }

    .card-search {
      border-radius: 20px;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 14px;
      background: linear-gradient(90deg, rgba(251, 113, 133, 0.1), rgba(96, 165, 250, 0.05));
    }

    .card-search .card-title {
      margin: 0;
      min-width: 70px;
      font-size: 13px;
      white-space: nowrap;
    }

    .card-search .search-box {
      flex: 1;
      margin-top: 0;
    }

    .card-title {
      font-size: 13px;
      margin: 0 0 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card-title span.icon { font-size: 15px; }

    .card-sub {
      font-size: 11px;
      margin: 0 0 10px;
      color: var(--text-muted);
    }

    .search-box {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
    }

    .input-wrap { position: relative; }

    .input-wrap input[type="text"] {
      width: 100%;
      padding: 9px 40px 9px 32px;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      outline: none;
      background: #f9fafb;
      transition: border-color 0.18s ease, box-shadow 0.18s ease, background 0.18s ease, transform 0.08s ease;
    }
    .input-wrap input::placeholder {
      color: #9ca3af;
      font-size: 12px;
    }
    .input-wrap input:focus {
      background: #ffffff;
      border-color: #fb7185;
      box-shadow: 0 0 0 1px rgba(251, 113, 133, 0.55), 0 10px 25px rgba(248, 113, 113, 0.18);
      transform: translateY(-1px);
    }
    .input-icon-left {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      color: #9ca3af;
    }
    .input-icon-right {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      color: #9ca3af;
    }

    .button-row {
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      gap: 8px;
      margin-top: 2px;
      overflow-x: auto;
    }

    button#searchBtn {
      padding: 7px 16px;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #f472b6, #fb7185);
      color: white;
      font-weight: 500;
      box-shadow: 0 10px 25px rgba(248, 113, 113, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
      white-space: nowrap;
    }
    button#searchBtn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 16px 30px rgba(248, 113, 113, 0.45);
    }
    button#searchBtn:active:not(:disabled) {
      transform: translateY(0px) scale(0.99);
      box-shadow: 0 8px 18px rgba(248, 113, 113, 0.3);
    }
    button#searchBtn:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
    }
    .btn-icon { font-size: 14px; }

    .btn-secondary {
      padding: 6px 12px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: #f9fafb;
      cursor: pointer;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .status {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }
    .status strong { color: #4b5563; }

    .result-card {
      max-height: 620px;
      min-height: 360px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding-top: 16px;
    }

    .result-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .result-header-right {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .badge-filter {
      padding: 2px 7px;
      border-radius: 999px;
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid rgba(248, 113, 113, 0.6);
      font-size: 10px;
    }

    .result-table-wrap {
      margin-top: 10px;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
    }

    .result-scroll {
      max-height: 520px;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      background: #ffffff;
      table-layout: fixed;
    }
    th, td {
      border-bottom: 1px solid #e5e7eb;
      padding: 8px 10px;
      text-align: left;
      vertical-align: middle;
      word-break: keep-all;
    }
    th {
      background: #f9fafb;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 1;
      padding-right: 14px;
    }
    tr:nth-child(even) td { background: #fdf2f8; }
    tr:hover td { background: #fce7f3; }

    th.col-product, td.col-product { width: 16.66%; }
    th.col-color, td.col-color     { width: 8.33%; }
    th.col-pcode, td.col-pcode     { width: 10%; }
    th.col-warehouse, td.col-warehouse { width: 10%; }

    .no-result {
      margin-top: 12px;
      font-size: 12px;
      color: #9ca3af;
    }

    .text-right { text-align: right; }
    .text-center { text-align: center; }

    .stock-header { text-align: center; }

    .result-table-wrap td {
      font-size: 12px !important;
    }

    .stock-pill {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border: 1px solid transparent;
    }
    .stock-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    .stock-pill-green {
      background: #ecfdf3;
      color: #166534;
      border-color: rgba(34, 197, 94, 0.45);
    }
    .stock-pill-green .stock-pill-dot { background: #22c55e; }
    .stock-pill-yellow {
      background: #fef9c3;
      color: #854d0e;
      border-color: rgba(250, 204, 21, 0.7);
    }
    .stock-pill-yellow .stock-pill-dot { background: #facc15; }
    .stock-pill-red {
      background: #fee2e2;
      color: #b91c1c;
      border-color: rgba(239, 68, 68, 0.7);
    }
    .stock-pill-red .stock-pill-dot { background: #ef4444; }

    .product-name-cell {
      position: relative;
      padding-left: 26px;
      cursor: pointer;
    }

    .op-status-dot {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 9px;
      height: 9px;
      border-radius: 999px;
      border: 2px solid #ffffff;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.4);
    }
    .op-status-dot--on    { background: #22c55e; }
    .op-status-dot--end   { background: #f97316; }
    .op-status-dot--stop  { background: #ef4444; }
    .op-status-dot--pause { background: #eab308; }

    .op-legend {
      display: none;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 6px;
    }
    .op-legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }
    .op-legend-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      border: 2px solid #ffffff;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.4);
    }
    .op-legend-dot.on    { background: #22c55e; }
    .op-legend-dot.end   { background: #f97316; }
    .op-legend-dot.stop  { background: #ef4444; }
    .op-legend-dot.pause { background: #eab308; }

    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15,23,42,0.92);
      color: #f9fafb;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 11px;
      box-shadow: 0 10px 25px rgba(15,23,42,0.5);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease, transform 0.18s ease;
      z-index: 9999;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }

    .kw-mark {
      background: #fef3c7;
      color: #92400e;
      padding: 0 1px;
      border-radius: 3px;
    }

    th.sortable {
      cursor: pointer;
      user-select: none;
    }
    th.sortable-active {
      background: #fee2e2;
    }
    .sort-indicator {
      margin-left: 4px;
      font-size: 10px;
      opacity: 0.7;
    }

    .resize-handle {
      position: absolute;
      top: 0;
      right: 0;
      width: 6px;
      height: 100%;
      cursor: col-resize;
      user-select: none;
      border-right: 1px solid transparent;
    }
    .resize-handle:hover {
      border-right-color: rgba(148, 163, 184, 0.8);
    }

    @media (max-width: 860px) {
      .app-shell { padding: 12px 8px 20px; }
      .inner-shell { padding: 14px 12px 16px; }
      .header { flex-direction: column; align-items: flex-start; gap: 10px; }
      .header-right { text-align: left; }
      .card-search { flex-direction: column; align-items: stretch; border-radius: 18px; }
      .card-search .card-title { font-size: 12px; }
      .result-header-row { flex-direction: column; align-items: flex-start; }
      .result-header-right { align-self: stretch; justify-content: space-between; white-space: normal; }
    }

    /* =========================================
       FINAL ‚Äì ADMIN UNIFIED (Í∏∞Ï§Ä ÌÖúÌîåÎ¶ø)
       ========================================= */
    body{
      font-family:'Pretendard',system-ui,sans-serif !important;
      font-size:10px !important;
      color:#111827;
    }

    .app-shell{
      background:
        radial-gradient(circle at top left, rgba(236,72,153,.35), transparent 55%),
        radial-gradient(circle at bottom right, rgba(96,165,250,.28), transparent 55%),
        radial-gradient(circle at top right, rgba(124,58,237,.22), transparent 55%),
        #fdf2ff !important;
      padding:18px !important;
    }

    .inner-shell{
      background: rgba(255,255,255,.78) !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
      border:1px solid rgba(255,255,255,.55) !important;
      border-radius:18px !important;
      box-shadow:0 24px 60px rgba(15,23,42,.22) !important;
    }

    .card{
      background: rgba(255,255,255,.70) !important;
      backdrop-filter: blur(12px) !important;
      -webkit-backdrop-filter: blur(12px) !important;
      border:1px solid rgba(148,163,184,.28) !important;
      border-radius:16px !important;
      box-shadow:0 10px 26px rgba(15,23,42,.12) !important;
    }

    .card-search{
      border-radius:16px !important;
      padding:10px 12px !important;
    }

    .title-wrap h1{ font-size:14px !important; }
    .card-title{ font-size:12px !important; }
    .card-sub,
    .status,
    .header-right,
    .result-header-right,
    .no-result{ font-size:9px !important; }

    .input-wrap input[type="text"]{
      font-size:10px !important;
      padding:8px 36px 8px 30px !important;
      border-radius:14px !important;
      background: rgba(255,255,255,.75) !important;
    }
    .input-wrap input::placeholder{ font-size:9px !important; }

    button#searchBtn{
      font-size:10px !important;
      padding:8px 14px !important;
      border-radius:14px !important;
      background: linear-gradient(135deg,#7c3aed,#ec4899) !important;
      box-shadow: 0 10px 25px rgba(124,58,237,.35) !important;
    }

    .btn-secondary{
      font-size:10px !important;
      padding:8px 12px !important;
      border-radius:14px !important;
    }

    table{ font-size:10px !important; }
    th{ font-size:9px !important; color:#6b7280 !important; }
    td{ font-size:10px !important; }
    .result-table-wrap td{ font-size:10px !important; }

    /* =========================================
       PREMIUM TUNING (v1)
       ========================================= */
    .app-shell{
      background:
        radial-gradient(circle at top left, rgba(236,72,153,.28), transparent 58%),
        radial-gradient(circle at bottom right, rgba(96,165,250,.22), transparent 58%),
        radial-gradient(circle at top right, rgba(124,58,237,.18), transparent 60%),
        #fdf2ff !important;
    }

    .inner-shell{
      position: relative !important;
      background: rgba(255,255,255,.72) !important;
      border: 1px solid rgba(255,255,255,.62) !important;
      box-shadow:
        0 28px 70px rgba(15,23,42,.20),
        inset 0 1px 0 rgba(255,255,255,.55) !important;
    }

    .inner-shell::before{
      content:"" !important;
      position:absolute !important;
      left:14px !important;
      right:14px !important;
      top:10px !important;
      height:42px !important;
      border-radius: 14px !important;
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,0)) !important;
      pointer-events:none !important;
      opacity:.55 !important;
    }

    .card{
      position: relative !important;
      background: rgba(255,255,255,.64) !important;
      border: 1px solid rgba(255,255,255,.42) !important;
      box-shadow:
        0 14px 34px rgba(15,23,42,.10),
        inset 0 1px 0 rgba(255,255,255,.50) !important;
      backdrop-filter: blur(10px) !important;
      -webkit-backdrop-filter: blur(10px) !important;
    }

    .card::before{
      content:"" !important;
      position:absolute !important;
      left:10px !important;
      right:10px !important;
      top:8px !important;
      height:22px !important;
      border-radius: 12px !important;
      background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,0)) !important;
      pointer-events:none !important;
      opacity:.35 !important;
    }

    button#searchBtn{
      box-shadow:
        0 14px 34px rgba(124,58,237,.30),
        inset 0 1px 0 rgba(255,255,255,.35) !important;
    }

    .input-wrap input[type="text"]{
      background: rgba(255,255,255,.66) !important;
      border: 1px solid rgba(255,255,255,.35) !important;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35) !important;
    }

    .input-wrap input[type="text"]:focus{
      border-color: rgba(124,58,237,.45) !important;
      box-shadow:
        0 0 0 3px rgba(124,58,237,.14),
        0 14px 30px rgba(15,23,42,.10) !important;
    }
    /* ===== ADMIN LAYOUT RULE (ALL PAGES) ===== */
:root{
  --page-pad: 18px;
  --page-max: 1400px;
}

html, body{
  height:100%;
}

body{
  padding: var(--page-pad) !important;
  margin: 0 !important;
  display: block !important;   /* flex center Î∞©ÏßÄ */
}

/* ÌéòÏù¥ÏßÄ ÏµúÏÉÅÏúÑ ÎûòÌçº */
.container,
.app-shell{
  width:100% !important;
  max-width: var(--page-max) !important;
  margin: 0 auto !important;
}

/* Î©îÏù∏ Ïπ¥Îìú/Ïú†Î¶¨Ìåê */
.card,
.inner-shell{
  min-height: calc(100vh - (var(--page-pad) * 2)) !important;
  display: flex !important;
  flex-direction: column !important;
}

/* Í≤∞Í≥º ÏòÅÏó≠ÏùÄ ÎÇ®Îäî ÎÜíÏù¥ Ï±ÑÏö∞Í∏∞ */
.table-wrapper,
.result-card,
.result-area,
#tableWrapper{
  flex: 1 1 auto !important;
}

/* ÌéòÏù¥ÏßÄÎßàÎã§ Îã§Î•¥Îçò ÎÜíÏù¥ Ï†úÌïú Ï†úÍ±∞ */
.table-wrapper{
  max-height: none !important;
}

  </style>
</head>

<body>
  <div class="app-shell">
    <div class="inner-shell">
      <div class="header">
        <div class="header-left">
          <div class="title-wrap">
            <h1>
              ÏÉÅÌíà Ï°∞Ìöå
              <span class="title-tag"> PlayMD </span>
            </h1>
          </div>
        </div>

        <div class="header-right">
          <div class="pill-label"></div>
          <div style="margin-top:4px;">
            <span id="stockInfo">Î°úÎî© Ï§ë...</span>
          </div>
        </div>
      </div>

      <div class="content-row">
        <!-- Í≤ÄÏÉâ Ïπ¥Îìú -->
        <div class="card card-search">
          <h2 class="card-title"><span class="icon">üîç</span>Í≤ÄÏÉâ</h2>

          <div class="search-box">
            <div class="input-wrap">
              <span class="input-icon-left">‚å®Ô∏è</span>
              <input type="text" id="keyword" placeholder="(Ïòà: Î≥ºÎìúÎ¶∞, Î≤®Î£®Ïò§, ÏÉÅÌíàÏΩîÎìú, ÏπºÎùºÏΩîÎìú Îì±)" />
              <span class="input-icon-right">Enter ‚Üµ</span>
            </div>

            <div class="button-row">
              <button id="searchBtn" disabled>
                <span class="btn-icon">‚ú®</span>Í≤ÄÏÉâ
              </button>

              <button type="button" id="resetBtn" class="btn-secondary">‚Ü∫ Ï¥àÍ∏∞Ìôî</button>

              <label style="display:inline-flex;align-items:center;gap:4px;cursor:pointer;font-size:11px;white-space:nowrap;">
                <input type="checkbox" id="toggleWarehouse" style="transform:scale(0.9);" />
                Ï∞ΩÍ≥†
              </label>

              <label style="display:inline-flex;align-items:center;gap:4px;cursor:pointer;font-size:11px;white-space:nowrap;">
                <input type="checkbox" id="toggleMaterial" style="transform:scale(0.9);" />
                ÏÜåÏû¨
              </label>

              <label style="display:inline-flex;align-items:center;gap:4px;cursor:pointer;font-size:11px;white-space:nowrap;">
                <input type="checkbox" id="toggleInStockOnly" style="transform:scale(0.9);" />
                Ïû¨Í≥† ÏûàÏùåÎßå
              </label>
            </div>

            <div class="status" id="status">Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
          </div>
        </div>

        <!-- Í≤∞Í≥º Ïπ¥Îìú -->
        <div class="card result-card">
          <div class="result-header-row">
            <h2 class="card-title"><span class="icon">üìã</span>Í≤ÄÏÉâ Í≤∞Í≥º</h2>
            <div class="result-header-right">
              <span id="resultInfo" style="font-size:11px;">ÏïÑÏßÅ Í≤ÄÏÉâ Ï†ÑÏù¥ÏóêÏöî.</span>
            </div>
          </div>

          <div id="opLegend" class="op-legend">
            <span class="op-legend-item"><span class="op-legend-dot on"></span> Ïö¥ÏòÅ</span>
            <span class="op-legend-item"><span class="op-legend-dot end"></span> ÏÜåÏßÑ ÌõÑ Ï¢ÖÎ£å</span>
            <span class="op-legend-item"><span class="op-legend-dot stop"></span> Îã®Ï¢Ö</span>
            <span class="op-legend-item"><span class="op-legend-dot pause"></span> ÏùºÏãú Ï§ëÎã®</span>
          </div>

          <div id="result"><div class="no-result"></div></div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">ÏõêÎûò ÏÉÅÌíàÎ™ÖÏùÑ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÌñàÏñ¥Ïöî.</div>

  <script>
    // ===== ÏãúÌä∏ ÏÑ§Ï†ï =====
    const PRODUCT_SHEET_ID = '1LPy69E2yPTaSwxFAYrX6qV0BZx1tW0YdonLRNqeo5Vc';
    const PRODUCT_GID = '885700988';

    const STOCK_SHEET_ID = '1_L12NKkBVU4c5xDPrYLUQRnSUG2NoAwYGWIfPDVO3bM';
    const STOCK_GID = '366983013';

    const OPER_SHEET_ID = '1F4EC5w1VPmFpwSbw0LuIv5QkwSSs8YkCBPZKY3h-z64';
    const OPER_GID = '2108422262';

    const PRODUCT_CSV_URL =
      `https://docs.google.com/spreadsheets/d/${PRODUCT_SHEET_ID}/export?format=csv&gid=${PRODUCT_GID}`;
    const STOCK_CSV_URL =
      `https://docs.google.com/spreadsheets/d/${STOCK_SHEET_ID}/export?format=csv&gid=${STOCK_GID}`;
    const OPER_CSV_URL =
      `https://docs.google.com/spreadsheets/d/${OPER_SHEET_ID}/export?format=csv&gid=${OPER_GID}`;

    // ===== Ï†ÑÏó≠ Îç∞Ïù¥ÌÑ∞ =====
    let products = [];
    let stockEntriesByColorCode = {};
    let sizeByColorCode = {};
    let stockUpdatedAt = '';

    let showMaterial = false;
    let showWarehouse = false;
    let inStockOnly = false;
    let opStatusByColorCode = {};

    let sortKey = 'productName';
    let sortDir = 'asc';

    let lastKeyword = '';

    const statusEl = document.getElementById('status');
    const resultEl = document.getElementById('result');
    const stockInfoEl = document.getElementById('stockInfo');
    const searchBtn = document.getElementById('searchBtn');
    const resetBtn = document.getElementById('resetBtn');
    const keywordInput = document.getElementById('keyword');
    const toggleMaterialInput = document.getElementById('toggleMaterial');
    const toggleWarehouseInput = document.getElementById('toggleWarehouse');
    const toggleInStockOnlyInput = document.getElementById('toggleInStockOnly');
    const toastEl = document.getElementById('toast');
    const opLegendEl = document.getElementById('opLegend');
    const resultInfoEl = document.getElementById('resultInfo');

    const regexBracket = /\[[^\]]*\]/g;
    const regexSeason  = /^\s*[0-9]{2}\s*(FW|SS)\s*/i;

    function cleanProductName(name) {
      if (!name) return '';
      return String(name)
        .replace(/[\r\n]+/g, '')
        .replace(/\u00A0/g, ' ')
        .replace(regexBracket, '')
        .replace(regexSeason, '')
        .replace(/\s*\([^)]*\)\s*[^()]*$/, '')
        .replace(/\([^)]*\)\s*$/, '')
        .replace(/\s{2,}/g, ' ')
        .trim();
    }

    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function parseCSV(text) {
      const parsed = Papa.parse(text, { header: false, skipEmptyLines: true });
      return parsed.data;
    }

    function showToast(msg) {
      if (!toastEl) return;
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(() => toastEl.classList.remove('show'), 1400);
    }

    function updateLegendVisibility() {
      if (!opLegendEl) return;
      const hasData = Object.keys(opStatusByColorCode).length > 0;
      opLegendEl.style.display = hasData ? 'flex' : 'none';
    }

    async function loadProducts() {
      const res = await fetch(PRODUCT_CSV_URL);
      if (!res.ok) throw new Error('ÏÉÅÌíà ÏãúÌä∏ Î°úÎìú Ïã§Ìå®: ' + res.status);

      const text = await res.text();
      const rows = parseCSV(text);
      if (rows.length < 2) return;

      const idxProductCode = 5;
      const idxColorName   = 15;
      const idxBarcode     = 20;
      const idxMaterial    = 22;
      const idxColorCode   = 25;
      const idxProductName = 26;

      products = rows.slice(1).map(row => {
        const rawName = row[idxProductName] || '';
        const cleanedName = cleanProductName(rawName);

        return {
          productCode: row[idxProductCode] || '',
          colorName:   row[idxColorName]   || '',
          barcode:     row[idxBarcode]     || '',
          material:    row[idxMaterial]    || '',
          colorCode:   row[idxColorCode]   || '',
          rawName,
          productName: cleanedName
        };
      }).filter(p => p.productName);
    }

    async function loadStock() {
      const res = await fetch(STOCK_CSV_URL);
      if (!res.ok) throw new Error('Ïû¨Í≥† ÏãúÌä∏ Î°úÎìú Ïã§Ìå®: ' + res.status);

      const text = await res.text();
      const rows = parseCSV(text);
      if (!rows.length) return;

      stockUpdatedAt = (rows[0][1] || '').trim();
      stockInfoEl.textContent = stockUpdatedAt || 'ÎØ∏Í∏∞Ïû¨';

      stockEntriesByColorCode = {};
      sizeByColorCode = {};

      for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        if (!row || !row.length) continue;

        const colorCode = (row[0] || '').trim();
        if (!colorCode) continue;

        const size      = (row[1] || '').trim();
        const warehouse = (row[2] || '').trim() || 'ÎØ∏Ï†ï';
        let qtyRaw      = (row[10] || '').toString().trim();
        if (!qtyRaw) continue;

        qtyRaw = qtyRaw.replace(/,/g, '');
        const qty = Number(qtyRaw);
        if (isNaN(qty)) continue;

        if (!stockEntriesByColorCode[colorCode]) stockEntriesByColorCode[colorCode] = [];
        stockEntriesByColorCode[colorCode].push({ warehouse, size, qty });

        if (!sizeByColorCode[colorCode] && size) sizeByColorCode[colorCode] = size;
      }
    }

    async function loadOperationStatus() {
      const res = await fetch(OPER_CSV_URL);
      if (!res.ok) return;

      const text = await res.text();
      const rows = parseCSV(text);
      if (rows.length < 2) return;

      for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        const colorCode = (row[0] || '').trim();
        const op = (row[2] || '').trim();
        if (!colorCode || !op) continue;
        opStatusByColorCode[colorCode] = op;
      }
      updateLegendVisibility();
    }

    async function init() {
      try {
        statusEl.textContent = 'ÏÉÅÌíà/Ïû¨Í≥† Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...';
        searchBtn.disabled = true;
        keywordInput.disabled = true;

        await Promise.all([loadProducts(), loadStock(), loadOperationStatus()]);

        statusEl.innerHTML = `Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å. <strong>ÏÉÅÌíà ${products.length}Í∞ú</strong>`;
        searchBtn.disabled = false;
        keywordInput.disabled = false;
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®: ' + err.message;
        stockInfoEl.textContent = 'Î°úÎìú Ïã§Ìå®';
      }
    }

    function buildOperationIndicator(colorCode) {
      const rawStatus = opStatusByColorCode[colorCode];
      if (!rawStatus) return '';

      const s = rawStatus.trim();
      const normalized = s.replace(/\s+/g, '').replace(/[()]/g, '');
      let cls = 'op-status-dot ';
      if (normalized.startsWith('Ïö¥ÏòÅ')) cls += 'op-status-dot--on';
      else if (normalized.startsWith('ÏÜåÏßÑÌõÑÏ¢ÖÎ£å')) cls += 'op-status-dot--end';
      else if (normalized.startsWith('Îã®Ï¢Ö')) cls += 'op-status-dot--stop';
      else cls += 'op-status-dot--pause';

      return `<span class="${cls}" title="${escapeHtml(s)}"></span>`;
    }

    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function highlightText(text, keyword) {
      const base = escapeHtml(text || '');
      if (!keyword) return base;
      const kw = keyword.trim();
      if (!kw) return base;
      const pattern = new RegExp(escapeRegExp(kw), 'gi');
      return base.replace(pattern, match => `<mark class="kw-mark">${match}</mark>`);
    }

    function buildHeaderCell(label, key, extraClass = '', textAlignCenter = false) {
      const isActive = sortKey === key;
      const arrow = isActive ? (sortDir === 'asc' ? '‚ñ≤' : '‚ñº') : '';
      const classes = [
        'sortable',
        isActive ? 'sortable-active' : '',
        extraClass || '',
        textAlignCenter ? 'text-center' : ''
      ].filter(Boolean).join(' ');

      return `
        <th class="${classes}" data-sort-key="${key}">
          <span class="th-label">${escapeHtml(label)}${
            arrow ? `<span class="sort-indicator">${arrow}</span>` : ''
          }</span>
          <span class="resize-handle"></span>
        </th>
      `;
    }

    function compareRows(a, b) {
      const direction = sortDir === 'desc' ? -1 : 1;
      const key = sortKey;

      function cmpString(sa, sb) {
        return sa.localeCompare(sb, 'ko-KR');
      }

      function tieBreak(a, b) {
        const nCmp = cmpString(a.productName || '', b.productName || '');
        if (nCmp !== 0) return nCmp;
        const cCmp = cmpString(a.colorName || '', b.colorName || '');
        if (cCmp !== 0) return cCmp;
        return cmpString(a.colorCode || '', b.colorCode || '');
      }

      if (key === 'stock') {
        const aNum = (typeof a.stockNum === 'number') ? a.stockNum : -1;
        const bNum = (typeof b.stockNum === 'number') ? b.stockNum : -1;
        if (aNum !== bNum) return (aNum < bNum ? -1 : 1) * direction;
        return tieBreak(a, b);
      }

      let valA = '';
      let valB = '';

      switch (key) {
        case 'productName': valA = a.productName || ''; valB = b.productName || ''; break;
        case 'colorName':   valA = a.colorName || '';   valB = b.colorName || ''; break;
        case 'barcode':     valA = a.barcode || '';     valB = b.barcode || ''; break;
        case 'productCode': valA = a.productCode || ''; valB = b.productCode || ''; break;
        case 'colorCode':   valA = a.colorCode || '';   valB = b.colorCode || ''; break;
        case 'size':        valA = a.size || '';        valB = b.size || ''; break;
        case 'material':    valA = a.material || '';    valB = b.material || ''; break;
        case 'warehouse':   valA = a.warehouse || '';   valB = b.warehouse || ''; break;
        default: return tieBreak(a, b);
      }

      const primary = cmpString(valA, valB);
      if (primary !== 0) return primary * direction;
      return tieBreak(a, b);
    }

    function search() {
      const kw = keywordInput.value.trim();
      lastKeyword = kw;

      if (!products.length) {
        statusEl.textContent = 'Îç∞Ïù¥ÌÑ∞Í∞Ä ÏïÑÏßÅ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
        return;
      }
      if (!kw) {
        statusEl.textContent = 'Í≤ÄÏÉâ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
        resultEl.innerHTML = '<div class="no-result">Í≤ÄÏÉâ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìïú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.</div>';
        if (resultInfoEl) resultInfoEl.textContent = 'Í≤ÄÏÉâ Ï†Ñ ÏûÖÎãàÎã§.';
        return;
      }

      const lowerKw = kw.toLowerCase();
      const filteredProducts = products.filter(p => {
        const name      = (p.productName || '').toLowerCase();
        const code      = (p.productCode || '').toLowerCase();
        const colorCode = (p.colorCode   || '').toLowerCase();
        return name.includes(lowerKw) || code.includes(lowerKw) || colorCode.includes(lowerKw);
      });

      if (!filteredProducts.length) {
        statusEl.textContent = `"${kw}" Í≤ÄÏÉâ Í≤∞Í≥º: 0Í∞ú`;
        resultEl.innerHTML = '<div class="no-result">Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå</div>';
        if (resultInfoEl) resultInfoEl.textContent = `Í≤ÄÏÉâÏñ¥ "${kw}" Í≤∞Í≥º 0Í∞ú`;
        return;
      }

      const rows = [];

      filteredProducts.forEach(p => {
        const entries = stockEntriesByColorCode[p.colorCode] || [];

        let useEntries;
        if (showWarehouse) useEntries = entries;
        else useEntries = entries.filter(e => e.warehouse === 'Ï£ºÌù¨Î¨ºÎ•ò');

        if (!useEntries.length) {
          rows.push({
            productName: p.productName || '',
            colorName:   p.colorName   || '',
            barcode:     p.barcode     || '',
            productCode: p.productCode || '',
            colorCode:   p.colorCode   || '',
            size:        sizeByColorCode[p.colorCode] || '',
            material:    p.material    || '',
            warehouse:   '',
            stockNum:    null,
            stockStr:    '',
            stockClass:  '',
            rawName:     p.rawName     || '',
            colorCodeKey: p.colorCode  || ''
          });
          return;
        }

        let sortedEntries = useEntries;
        if (showWarehouse) {
          sortedEntries = [...useEntries].sort((a, b) => {
            const aw = a.warehouse || '';
            const bw = b.warehouse || '';
            if (aw === 'Ï£ºÌù¨Î¨ºÎ•ò' && bw !== 'Ï£ºÌù¨Î¨ºÎ•ò') return -1;
            if (bw === 'Ï£ºÌù¨Î¨ºÎ•ò' && aw !== 'Ï£ºÌù¨Î¨ºÎ•ò') return 1;
            return aw.localeCompare(bw, 'ko-KR');
          });
        }

        sortedEntries.forEach(entry => {
          const stockNum = entry.qty;
          const stockStr = String(stockNum);
          let stockClass = 'stock-pill stock-pill-green';
          if (!isNaN(stockNum)) {
            if (stockNum >= 100) stockClass = 'stock-pill stock-pill-green';
            else if (stockNum >= 10) stockClass = 'stock-pill stock-pill-yellow';
            else stockClass = 'stock-pill stock-pill-red';
          }

          rows.push({
            productName: p.productName || '',
            colorName:   p.colorName   || '',
            barcode:     p.barcode     || '',
            productCode: p.productCode || '',
            colorCode:   p.colorCode   || '',
            size:        entry.size || sizeByColorCode[p.colorCode] || '',
            material:    p.material    || '',
            warehouse:   showWarehouse ? (entry.warehouse || '') : '',
            stockNum,
            stockStr,
            stockClass,
            rawName:     p.rawName     || '',
            colorCodeKey: p.colorCode  || ''
          });
        });
      });

      let usedRows = rows;
      if (inStockOnly) usedRows = rows.filter(r => typeof r.stockNum === 'number' && r.stockNum > 0);

      if (!usedRows.length) {
        statusEl.innerHTML = `"${kw}" Í≤ÄÏÉâ Í≤∞Í≥º: <strong>0Ìñâ</strong> (Ïû¨Í≥† ÏûàÏùåÎßå ÌïÑÌÑ∞ Ï†ÅÏö©)`;
        resultEl.innerHTML = '<div class="no-result">Ï°∞Í±¥Ïóê ÎßûÎäî Ïû¨Í≥†Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
        if (resultInfoEl) resultInfoEl.innerHTML = `"${escapeHtml(kw)}" / Ìñâ 0Í∞ú <span class="badge-filter">Ïû¨Í≥† ÏûàÏùåÎßå</span>`;
        return;
      }

      usedRows.sort(compareRows);

      statusEl.innerHTML = `"${kw}" Í≤ÄÏÉâ Í≤∞Í≥º: <strong>${usedRows.length}Ìñâ</strong>`;
      if (resultInfoEl) {
        const countStr = usedRows.length.toLocaleString();
        resultInfoEl.innerHTML = inStockOnly
          ? `"${escapeHtml(kw)}" / Ìñâ ${countStr}Í∞ú <span class="badge-filter">Ïû¨Í≥† ÏûàÏùåÎßå</span>`
          : `"${escapeHtml(kw)}" / Ìñâ ${countStr}Í∞ú`;
      }

      let headerHtml = '';
      headerHtml += buildHeaderCell('ÏÉÅÌíàÎ™Ö', 'productName', 'col-product');
      headerHtml += buildHeaderCell('ÏπºÎùºÎ™Ö', 'colorName', 'col-color');
      headerHtml += buildHeaderCell('Î∞îÏΩîÎìú', 'barcode');
      headerHtml += buildHeaderCell('ÏÉÅÌíàÏΩîÎìú', 'productCode', 'col-pcode');
      headerHtml += buildHeaderCell('ÏÉÅÌíàÏπºÎùºÏΩîÎìú', 'colorCode');
      headerHtml += buildHeaderCell('ÏÇ¨Ïù¥Ï¶à', 'size');
      if (showMaterial) headerHtml += buildHeaderCell('ÏÜåÏû¨', 'material');
      if (showWarehouse) headerHtml += buildHeaderCell('Ï∞ΩÍ≥†', 'warehouse', 'col-warehouse');
      headerHtml += buildHeaderCell('Ïû¨Í≥†', 'stock', 'stock-header', true);
      headerHtml += '</tr>';

      let bodyHtml = '';
      usedRows.forEach(r => {
        const opIndicatorHtml = buildOperationIndicator(r.colorCode);
        const rawNameEsc = escapeHtml(r.rawName || '');
        const hasRaw = r.rawName && r.rawName !== r.productName;
        const titleAttr = hasRaw ? ` title="${rawNameEsc}"` : '';

        const hasStock = r.stockStr && r.stockClass;
        const stockCellInner = hasStock ? `
          <span class="stock-cell" data-product-name="${escapeHtml(r.productName)}">
            <span class="${r.stockClass}">
              <span class="stock-pill-dot"></span>${escapeHtml(r.stockStr)}
            </span>
          </span>
        ` : '';

        bodyHtml += `
          <tr>
            <td class="product-name-cell col-product"${titleAttr} data-color-code="${escapeHtml(r.colorCodeKey || '')}">
              ${opIndicatorHtml}${highlightText(r.productName || '', lastKeyword)}
            </td>
            <td class="col-color">${highlightText(r.colorName || '', lastKeyword)}</td>
            <td>${highlightText(r.barcode || '', lastKeyword)}</td>
            <td class="col-pcode">${highlightText(r.productCode || '', lastKeyword)}</td>
            <td>${highlightText(r.colorCode || '', lastKeyword)}</td>
            <td>${highlightText(r.size || '', lastKeyword)}</td>
            ${showMaterial ? `<td>${highlightText(r.material || '', lastKeyword)}</td>` : ''}
            ${showWarehouse ? `<td class="col-warehouse">${highlightText(r.warehouse || '', lastKeyword)}</td>` : ''}
            <td class="text-right">${stockCellInner}</td>
          </tr>
        `;
      });

      resultEl.innerHTML = `
        <div class="result-table-wrap">
          <div class="result-scroll">
            <table>
              <thead>${headerHtml}</thead>
              <tbody>${bodyHtml}</tbody>
            </table>
          </div>
        </div>
      `;

      updateLegendVisibility();
      attachTableHeaderEvents();
    }

    function attachTableHeaderEvents() {
      const table = resultEl.querySelector('table');
      if (!table) return;

      const thead = table.querySelector('thead');
      const ths = thead ? Array.from(thead.querySelectorAll('th')) : [];

      ths.forEach((th, index) => {
        const key = th.dataset.sortKey;

        if (key) {
          th.addEventListener('click', (e) => {
            if (e.target.classList.contains('resize-handle') || e.target.closest('.resize-handle')) return;
            if (sortKey === key) sortDir = (sortDir === 'asc') ? 'desc' : 'asc';
            else { sortKey = key; sortDir = 'asc'; }
            search();
          });
        }

        let handle = th.querySelector('.resize-handle');
        if (!handle) {
          handle = document.createElement('span');
          handle.className = 'resize-handle';
          th.appendChild(handle);
        }

        handle.addEventListener('mousedown', (e) => {
          e.stopPropagation();
          startColumnResize(e, table, th, index);
        });
      });
    }

    function startColumnResize(e, table, th, colIndex) {
      const startX = e.pageX;
      const startWidth = th.offsetWidth;

      const bodyRows = table.tBodies[0] ? Array.from(table.tBodies[0].rows) : [];
      const thead = table.tHead;
      const headCells = thead ? Array.from(thead.rows[0].cells) : [];

      function onMouseMove(ev) {
        const dx = ev.pageX - startX;
        const newWidth = Math.max(60, startWidth + dx);

        if (headCells[colIndex]) headCells[colIndex].style.width = newWidth + 'px';
        bodyRows.forEach(row => { if (row.cells[colIndex]) row.cells[colIndex].style.width = newWidth + 'px'; });
      }

      function onMouseUp() {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
      }

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
      document.body.style.cursor = 'col-resize';
      document.body.style.userSelect = 'none';
    }

    // Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
    searchBtn.addEventListener('click', search);
    keywordInput.addEventListener('keydown', e => { if (e.key === 'Enter') search(); });

    toggleMaterialInput.addEventListener('change', () => {
      showMaterial = toggleMaterialInput.checked;
      if (keywordInput.value.trim()) search();
    });

    toggleWarehouseInput.addEventListener('change', () => {
      showWarehouse = toggleWarehouseInput.checked;
      if (keywordInput.value.trim()) search();
    });

    toggleInStockOnlyInput.addEventListener('change', () => {
      inStockOnly = toggleInStockOnlyInput.checked;
      if (keywordInput.value.trim()) search();
    });

    resetBtn.addEventListener('click', () => {
      keywordInput.value = '';
      showMaterial = false;
      showWarehouse = false;
      inStockOnly = false;
      lastKeyword = '';

      toggleMaterialInput.checked = false;
      toggleWarehouseInput.checked = false;
      toggleInStockOnlyInput.checked = false;

      sortKey = 'productName';
      sortDir = 'asc';

      statusEl.textContent = 'Í≤ÄÏÉâ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
      resultEl.innerHTML = '<div class="no-result">ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÍ≥† Í≤ÄÏÉâÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.</div>';
      if (resultInfoEl) resultInfoEl.textContent = 'Ï¥àÍ∏∞ ÏÉÅÌÉúÏûÖÎãàÎã§.';
    });

    // ÏÉÅÌíàÎ™Ö ÌÅ¥Î¶≠ ‚Üí ÏõêÎûò ÏÉÅÌíàÎ™Ö Î≥µÏÇ¨
    resultEl.addEventListener('click', e => {
      const cell = e.target.closest('.product-name-cell');
      if (!cell) return;

      const colorCode = cell.dataset.colorCode;
      if (!colorCode) return;

      const prod = products.find(p => p.colorCode === colorCode);
      if (!prod || !prod.rawName) return;

      const textToCopy = prod.rawName;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(textToCopy)
          .then(() => showToast('ÏõêÎûò ÏÉÅÌíàÎ™ÖÏùÑ Î≥µÏÇ¨ÌñàÏñ¥Ïöî.'))
          .catch(() => showToast('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏñ¥Ïöî. Î∏åÎùºÏö∞Ï†Ä Í∂åÌïúÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.'));
      } else {
        const ta = document.createElement('textarea');
        ta.value = textToCopy;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); showToast('ÏõêÎûò ÏÉÅÌíàÎ™ÖÏùÑ Î≥µÏÇ¨ÌñàÏñ¥Ïöî.'); }
        catch { showToast('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏñ¥Ïöî.'); }
        document.body.removeChild(ta);
      }
    });

    // ÌÉÄÏù¥ÌãÄ ÌÅ¥Î¶≠ ‚Üí ÏÇ¨Ïù¥Ìä∏ Í≤ÄÏÉâ
    document.addEventListener('DOMContentLoaded', () => {
      const titleEl = document.querySelector('.title-wrap h1');
      if (titleEl) titleEl.addEventListener('click', () => {
        window.open('https://whitesands.co.kr/product/search.html?keyword=', '_blank');
      });
    });

    // Ïû¨Í≥† pill ÌÅ¥Î¶≠ ‚Üí Í≤ÄÏÉâ ÌõÑ Ï≤´ ÏÉÅÌíàÏúºÎ°ú Ïù¥Îèô (Ï£ºÏùò: ÌÅ¨Î°úÏä§ ÎèÑÎ©îÏù∏ Ï†úÌïú Í∞ÄÎä•)
    document.addEventListener("click", async (e) => {
      const cell = e.target.closest(".stock-cell");
      if (!cell) return;

      const productName = cell.dataset.productName;
      if (!productName) return;

      const searchUrl = `https://whitesands.co.kr/product/search.html?keyword=${encodeURIComponent(productName)}`;
      const newTab = window.open(searchUrl, "_blank");

      try {
        newTab.onload = async () => {
          try {
            const firstProductLink = newTab.document.querySelector(".prdList .thumbnail a");
            if (firstProductLink) {
              const href = firstProductLink.href.startsWith("http")
                ? firstProductLink.href
                : `https://whitesands.co.kr${firstProductLink.getAttribute("href")}`;
              newTab.location.href = href;
            } else {
              alert(`"${productName}" Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.`);
            }
          } catch (err) {
            console.error(err);
            alert("ÏÉÅÌíà ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï† Ïàò ÏóÜÏäµÎãàÎã§.");
          }
        };
      } catch (e2) {
        console.log(e2);
      }
    });

    // Îã®Ï∂ïÌÇ§: Ctrl+K / Cmd+K / /
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && (e.key === 'k' || e.key === 'K')) {
        e.preventDefault();
        keywordInput.focus();
        keywordInput.select();
        return;
      }
      if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey) {
        const tag = document.activeElement && document.activeElement.tagName;
        if (tag !== 'INPUT' && tag !== 'TEXTAREA') {
          e.preventDefault();
          keywordInput.focus();
          keywordInput.select();
        }
      }
    });

    init();
  </script>
</body>
</html>

